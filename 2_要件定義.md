# 要求定義フェーズの進み方

以下は、01_stakeholder-needs.md（ステークホルダー要求）を  
**“ドラフト → 質問解消 → 完成（Freeze）”**  
という 3 ステップで確実に仕上げ、その後 **STEP4 で要件定義書（02_system-requirements.md）を生成する**  
ための **完全で再現性のある運用プロセス**である。

このプロセスを採用することで、  
後続の「設計書 → ADR → 実装 → テスト」まで  
一切の破綻なく進められる。

---

# STEP 1：Draft を作成する（初回生成フェーズ）

## 目的
ヒアリングメモ（生情報）から、  
**固定テンプレ構造にマッピングされた 01_stakeholder-needs.md（ドラフト版）を生成する**。

## 使うコマンド
`.claude/commands/requirements-draft.md`

## Claude への指示例
箇条書きのヒアリングメモ(箇条書き)をもとに  
docs/requirements/01_stakeholder-needs.md のドラフトを生成する。

```claude
/requirements-draft.md memo.txt
```

## Draft の特徴
- 各セクションが埋まるが、内容は荒い
- STK-xxx が並ぶが、情報不足が多い
- **7. Open Questions セクションが必ず生成される**
  - 不足情報  
  - 曖昧な表現  
  - 判断に必要な材料  
  - 想定のブレが大きい箇所  

Draft の目的は「全体像を出すこと」であり、  
**完成している必要はない**。  
むしろ未確定項目を Open Questions に送るのは正しい。

---

# STEP 2：Refine（質問解消 → 再生成 → 精緻化）← 最重要フェーズ

## 目的
01_stakeholder-needs.md の  
**“7. Open Questions” を 0 に近づけるための対話と更新** を行う。

## 使うコマンド
`.claude/commands/requirements-refine.md`

## 流れ（ループ）
1. Claude が提示した Open Questions を、人間（あなた）が回答する  
2. Claude に回答を渡して 01 を再生成させる  
3. Claude が更新した内容をレビュー  
4. 新たに発生した不明点があれば、Open Questions を追加  
5. Open Questions が無くなるまでループ

---

## Claude への指示例
01_stakeholder-needs.md の Open Questions に回答する。

```claude
/requirements-refine memo2.txt
```

---

## 期待される結果
- **Open Questions が減る**
- 各 STK-xxx の背景・目的・詳細が埋まる
- 受入条件が具体化される
- Constraints / Assumptions が明確化
- Stakeholder List が正確になる
- Scope（In/Out）が確定する

---

## 終了条件（Refine の出口）
- **7. Open Questions が空欄（または None）**
- STK 要求がすべて記述された
- 他工程へ進めるだけの精度になっている

---

# STEP 3：Freeze（要求を凍結し、後工程の唯一の基準にする）

## 目的
01_stakeholder-needs.md を  
**“要求定義の基準点（Baseline）”** として凍結し、  
要件定義書（02_system-requirements.md）を生成可能な状態にする。

## Claude への宣言（必須）
```claude
docs/requirements/01_stakeholder-needs.md は完成しました。
Open Questions は存在しません。
この文書は要求の基準点として凍結します。

以降、このファイルの内容を前提として、
要件定義（02_system-requirements.md）生成フェーズに進んでください。
```

---

## Freeze による効果
- 01 が次工程（02）の唯一の参照点になる  
- 02_system-requirements.md がブレなく生成される  
- Glossary / Context Diagram の整合性が保証される  
- ADR の背景が正しくなる  
- 実装計画の粒度が安定する  

Freeze は **品質保証上の重大イベント** である。

---

# STEP 4：要件定義書（02_system-requirements.md）生成 ← 新規追記

## 目的
凍結された 01_stakeholder-needs.md を基準として、  
**システム要件（機能要件 / 非機能要件）を完全構造で生成する**。

## 使うコマンド
`.claude/commands/requirements-definition.md`

## Claude への指示例
```claude
/requirements-definition
```

## このステップで行われること
- STK 要求を REQ-F / REQ-NF に変換  
- トレーサビリティ（STK-ID → REQ-ID）を自動生成  
- 機能要件に「入力 / 出力 / 前提 / 例外 / 受入条件」を追加  
- 非機能要件をカテゴリーごとに分類  
- 曖昧な値には Claude が数値化案を提案（例：応答時間、稼働率）

## 完了条件
- 02_system-requirements.md がテンプレ構造を満たしている  
- すべての REQ-ID に対応する STK-ID が存在する  
- 機能要件 / 非機能要件が完全に分離  
- 設計フェーズに進める整合性が取れている

---

# ■ まとめ：

```
STEP 1：Draft  
  ↓（Open Questions が発生）

STEP 2：Refine  
  ↓（Open Questions が 0 になる）

STEP 3：Freeze  
  ↓（要求が確定）

STEP 4： requirements-definition コマンドで
         02_system-requirements.md を確定生成
```