# 要求定義フェーズの進み方（01＋02 完全版）

01_stakeholder-needs.md（ステークホルダー要求）と  
02_system-requirements.md（要件定義書）を、

- 01：Draft → Refine → Freeze  
- 02：Draft → Refine → Freeze  

という **6ステップ** で確実に仕上げるための運用プロセス。

このプロセスにより、  
後続の「アーキテクチャ検討 → ADR → 設計 → 実装 → テスト」が破綻しない状態をつくる。

---

# STEP 1：01 Draft を作成（ヒアリング → 初回生成）

## 目的
ヒアリングメモを  
**固定テンプレ構造の 01_stakeholder-needs.md に落とし込んだドラフト**として生成する。

## 使うコマンド
`.claude/commands/requirements-draft.md`

## Claude への指示例
```claude
/requirements-draft.md memo.txt
```

## Draft の特徴
- 各セクションが埋まるが内容は荒い
- STK-xxx が列挙されるが不足が多い
- **7. Open Questions が必ず生成される**

Draft の目的は「まず全体像を出すこと」であり、完成している必要はない。

---

# STEP 2：01 Refine（Open Questions 解消 → 再生成）

## 目的
**01_stakeholder-needs.md の “7. Open Questions” を 0 に近づける**

## 使うコマンド
`.claude/commands/requirements-refine.md`

## 流れ（ループ）
1. Open Questions を読み取り  
2. あなたが回答を作る  
3. 回答を渡し、01 を再生成  
4. 内容をレビューし、不足があれば Open Questions に残す or 追加  
5. 繰り返し

## Claude への指示例
```claude
/requirements-refine memo2.txt
```

## 終了条件
- 7. Open Questions が空欄（または `None` のみ）
- STK 要求が他工程へ渡せるレベルに整理されている

---

# STEP 3：01 Freeze（要求を凍結）

## 目的
01_stakeholder-needs.md を  
**“要求定義の基準点（Baseline）”** として固定する。

## Claude への宣言（必須）
```claude
docs/requirements/01_stakeholder-needs.md は完成しました。
Open Questions は存在しません。
この文書は要求の基準点として凍結します。

以降、このファイルの内容を前提として、
要件定義（02_system-requirements.md）生成フェーズに進んでください。
```

---

# STEP 4：02 Draft（要件定義書の初回生成）

## 目的
凍結された 01 要求を  
**02_system-requirements.md（機能／非機能）へ構造化する。**

## 使うコマンド
`.claude/commands/requirements-definition.md`

## Claude への指示例
```claude
/requirements-definition
```

## このステップで行われること
- STK 要求 → REQ-F（機能）/ REQ-NF（非機能）に変換  
- トレーサビリティ（STK → REQ）を自動生成  
- 機能要件に入出力・前提・例外・受入条件を追加  
- 非機能要件をカテゴリごとに整理  
- 曖昧な値は Claude が数値化提案  
- **6. Open Questions が生成される（正常）**

## 完了条件
- テンプレ構造通りに 02_system-requirements.md が生成される  
- すべての REQ に対応する STK が存在する  

---

# STEP 5：02 Refine（要件側の Open Questions 解消）

## 目的
**02_system-requirements.md の “6. Open Questions” を解消して完成させる。**

## 使うコマンド
`.claude/commands/requirements-definition-refine.md`

## 流れ（ループ）
1. Open Questions を読み取り  
2. 回答を作る  
3. 回答を渡し、02 をテンプレ構造のまま再生成  
4. レビューし、さらに曖昧なら Open Questions に残す or 追加  
5. 完全解消までループ

## Claude への指示例
```claude
/requirements-definition-refine memo_req_answers.txt
```

## 終了条件
- 6. Open Questions が空欄（または `"None"` のみ）
- 機能／非機能要件がテスト仕様に直結する精度になっている

---

# STEP 6：02 Freeze（要件を凍結）

## 目的
02_system-requirements.md を  
**“システム要件の基準点（Baseline）”** として固定する。

## Claude への宣言（必須）
```claude
docs/requirements/02_system-requirements.md は完成しました。
Open Questions は存在しません。
この文書はシステム要件の基準点として凍結します。

以降、このファイルの内容を前提として、
アーキテクチャ検討・ADR・設計フェーズに進んでください。
```

---

# 全体像（01＋02 完全プロセス）

```
STEP 1：01 Draft（requirements-draft）
  ↓
STEP 2：01 Refine（requirements-refine）
  ↓
STEP 3：01 Freeze（要求凍結）
  ↓
STEP 4：02 Draft（requirements-definition）
  ↓
STEP 5：02 Refine（requirements-definition-refine）
  ↓
STEP 6：02 Freeze（要件凍結）
  ↓
→ システム設計（system-design コマンド、C4モデル）
→ アーキテクチャ検討（architecture-decision コマンド）
→ ADR 作成
→ ソフトウェア設計（UI / ドメイン / IF）
→ プラン
→ 実装
→ テスト
```
