# 要件定義書 作成プロセス定義書  
（02_system-requirements.md の正式運用ルール）

本書は以下を目的とする。

1. 要求定義で得た情報を **矛盾なく・漏れなく・勝手な解釈なしに** 要件へ昇華する  
2. 要件定義書テンプレートに沿って **一貫した粒度と品質** で作成できるようにする  
3. 要求・要件・機能の混同を防ぎ、後工程の設計・実装・テストに完全連携させる  

---

# 0. プロセス全体フロー（厳守）

1. **要求定義書の精読（Purpose / Needs / Constraints の再確認）**  
2. **用語抽出（Definitions）**  
3. **要求 → 機能要件の導出（Functional Requirements）**  
4. **要求 → 非機能要件の導出（Non-Functional Requirements）**  
5. **制約の継承と補完（Constraints）**  
6. **要件化できなかった不明点整理（Open Questions）**  
7. **要求 ↔ 要件 マッピング表作成（Appendix）**  
8. **レビュー（ステークホルダー整合 / 設計観点レビュー）**  

工程を飛ばしてはならない。  
特に **Definitions と Open Questions の手抜きは手戻りの主原因**。

---

# 1. Overview 作成プロセス

## 1.1 入力
- 01_stakeholder-needs.md の Purpose  
- 4. Stakeholder Needs の全要求  
- 5. Constraints（要求側の制約）  

## 1.2 作成手順
1. 要求で定義された「Why」を 3〜5 行で要約  
2. システム境界が In / Out と一致しているか確認  
3. 「システムの目的（What）に落ちていないか」をチェック  
4. 必要であれば **Scope の明確化（暗黙的な拡張を防ぐ）**

## 1.3 禁止事項
- 具体機能を書く  
- 技術要件を書く  
- 抽象語のまま残す（→ メモして後で Functional/Non-Functional に落とす）

---

# 2. Definitions（用語定義）の作成プロセス

## 2.1 入力
- 要求で頻出する名詞  
- 業務フローに登場する役割・データ  
- 曖昧語（例：案件、データ、管理、処理）  

## 2.2 抽出ルール
以下をすべて「Term」として抽出する。

| タイプ | 例 |
|-------|----|
| システム境界用語 | ユーザ、管理者、外部システム |
| データ用語 | ログ、案件、レポート種別 |
| 操作用語 | 承認、登録、集計 |
| 属性用語 | ステータス、カテゴリ、識別子 |
| 曖昧語 | 迅速、正確、簡易 |

## 2.3 記述形式
Definitions はあくまで **仮リスト**。  
本番の Glossary（03_glossary.md）は後工程。

## 2.4 注意点
- 曖昧語は “具体化前の状態” で書いてよい  
- Related Requirements に STK-xxx を付ける  
- 定義を勝手に補完しない（→ 必ず根拠を要求側に求める）

---

# 3. Functional Requirements（機能要件）作成プロセス

## 3.1 入力
- 4. Stakeholder Needs の **STK-xxx**（要求）  
- Definitions（定義）
- Constraints（要求側）  

## 3.2 導出ルール（最重要）
**1つの STK-xxx が、複数の REQ-F-xxx に分割されるのが通常。**

### 導出の基準
- 要求の「必要性（Why）」に対して  
- それを満たす「システムの動作（What）」を定義する  

例：  
要求「レポートを迅速に作成したい」  
→ 要件  
- REQ-F-001: レポート生成機能  
- REQ-F-002: 入力フォーム  
- REQ-F-003: 保存と履歴  
- REQ-F-004: 進捗状態管理  

要求は抽象でも、要件は具体動作として分解する。

---

## 3.3 REQ-F 要件の書き方

### Step 1: タイトル（動詞 + 名詞）
例：  
- 「レポート作成処理の実行」  
- 「ステータス変更機能」  
- 「外部APIからのデータ取得」  

### Step 2: 概要
要求の “Why” を踏まえた、機能の本質を1行でまとめる。

### Step 3: 詳細
次の4項目は必須：

- システムが実行すべき動作  
- 入力/出力  
- エラー・例外  
- 条件分岐に必要な情報  

### Step 4: 受入条件  
**必ず定量化・検証可能にする。**

悪例：  
- 正常に動作すること  
- 迅速に処理できる  

良例：  
- レポート生成が 5 秒以内に完了する  
- 入力チェックエラーは画面上部に表示される  

### Step 5: 関連要求
- 必ず STK-xxx を書く  
- 1つの機能要件に複数の要求が紐づいてもよい  

---

## 3.4 規模管理ルール
- 1 REQ-F は 1 行為（単一責任）  
- 「まとめすぎ」を防ぐため、2段階分解を推奨：

```
STK-xxx → 要求クラスター → REQ-F（分割）
```

---

# 4. Non-Functional Requirements（非機能要件）作成プロセス

## 4.1 入力
- 要求フェーズで拾っていた “抽象的な期待”  
- Constraints（技術・運用・外部連携）  
- Open Questions の中の技術的背景  

## 4.2 NFR の分類
ISO/IEC 25010 に沿って分類する。

| カテゴリ | 例 |
|----------|-----|
| パフォーマンス | 応答時間、スループット |
| セキュリティ | 認証、認可、暗号化 |
| 保守性 | 拡張性、変更容易性 |
| 可用性 | 稼働率、フェイルオーバー |
| 運用性 | ログ、監視、リカバリ |
| 信頼性 | データ完全性、エラーレート |

## 4.3 書き方
REQ-NF-XXX として記述する。

例：
```
#### REQ-NF-003: 障害発生時の自動復旧
- 詳細: Web アプリケーションは異常停止時に自動再起動すること
- 数値基準: 復旧までの時間は 60 秒以内
```

定量化できない場合は **候補値を提示してステークホルダーに確認する**。

---

# 5. Constraints（制約）の継承と補完

## 5.1 入力
- 01_stakeholder-needs.md の Constraints  
- 要件作成中に発見した追加制約  

## 5.2 書くべき内容
次のようなもの：

- プラットフォーム強制（Windows/Qt など）
- API 仕様の固定
- 運用時間の制限
- データフォーマット固定
- 外部システムに依存する仕様

## 5.3 曖昧なものの扱い
必ず「情報不足」と書く。

例：
```
- レポート生成サーバーは既存環境を流用する想定（情報不足: 仕様不明）
```

---

# 6. Open Questions 作成プロセス

## 6.1 入力
- 機能要件として定義しきれなかった部分  
- 非機能要件として曖昧な部分  
- 用語定義が不完全な部分  

## 6.2 書き方
```
| 質問 | 理由 / 影響範囲 | 誰に確認すべきか |
```

例：
```
| 管理者権限でステータス変更できる範囲は？ | 認可要件に影響 | STKH-003 |
```

## 6.3 注意点
- **不明点は必ず残す**  
- 想像で埋めてはならない  
- ここが弱いと要件定義が形骸化する

---

# 7. Appendix（マッピング表）

## 7.1 内容
- 要求（STK-xxx）と要件（REQ-F / REQ-NF）を1対多で紐づける  
- “要求を満たせていない要件がないか” を確認する  
- “要件に根拠のないものがないか” を確認する  

例：
```
STK-012 → REQ-F-021, REQ-F-022, REQ-NF-004
STK-019 → REQ-F-033
```

## 7.2 目的
- 要求と要件のトレーサビリティを保証  
- テスト設計時に網羅性を担保  

---

# 8. レビュー手順

### 8.1 ステークホルダー向けレビュー
- 要求に対する要件の解釈が正しいか  
- 不足・過剰がないか  
- 業務フローと矛盾していないか  

### 8.2 技術系レビュー
- 要件が実装可能か  
- 非機能要件が現実的か  
- Constraints と矛盾していないか  

---

# 9. 最終チェックリスト（必須）

- [ ] 要求と要件が1対多で正しく紐づいているか  
- [ ] 要件が「具体的な動作」で書かれているか  
- [ ] 受入条件が定量化されているか  
- [ ] 非機能要件が抜けていないか  
- [ ] Constraints が最新になっているか  
- [ ] Open Questions が漏れていないか  
- [ ] Definitions に曖昧語が残っていないか  

---

# 付録：作業の入力
```
docs/requirements/01_stakeholder-needs.md
```

---

# まとめ（重要ポイント）
- 要件定義は **要求の“解釈”ではなく、“論理的な分解”**  
- 曖昧な部分はすべて Definitions と Open Questions に送る  
- 特に非機能要件（保守性・性能・可用性）は要求フェーズで漏れやすいため注意  

