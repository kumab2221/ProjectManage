# 1. プロジェクト作成（Claude Code 前提）

## 1.1 目的
- Claude Code と MCP（Context7 ほか）を前提にした開発プロジェクトの初期セットアップを標準化する。
- どのプロジェクトでも本章の手順を完了していれば、後続フェーズ（要件定義〜設計〜ADR〜実装〜テスト）を再現性をもって進められる状態にする。

---

## 1.2 手順概要

1. プロジェクトディレクトリの作成  
2. Python 仮想環境（uv）＋リンタ/型チェッカ導入  
3. Git 初期化  
4. ベースディレクトリ構成の作成  
5. Claude Code 初期化  
6. ベース MCP の追加  
7. ベースメモリ（Claude.md）の作成  
8. カスタムコマンド（`.claude/commands/*.md`）の追加  

---

## 1.3 プロジェクトディレクトリ作成

```sh
mkdir <project>
cd <project>
```

- `<project>` はリポジトリ名と一致させる。

---

## 1.4 仮想環境の追加（Python / uv）

```sh
uv init .
uv add --dev ruff mypy
```

- `uv init .` で `pyproject.toml` と仮想環境を作成する。
- `ruff` と `mypy` は標準の品質チェックツールとして必須とする。

---

## 1.5 Git 初期化

```sh
git init .
git branch -M main
```

- 必要に応じて `.gitignore` を作成する（Python / uv / VSCode など）。

---

## 1.6 ベースディレクトリ構成

```sh
mkdir -p src tests
mkdir -p docs/requirements docs/design
mkdir -p ADR
mkdir -p plans
mkdir -p docs/release-notes
mkdir -p .github/workflows
mkdir -p .claude/commands
```

- `docs/requirements/`：要件定義関連
- `docs/design/`：設計書
- `ADR/`：アーキテクチャ決定記録
- `plans/`：機能別の実装計画
- `docs/release-notes/`：リリースノート
- `.github/workflows/`：GitHub Actions 用 CI 設定
- `.claude/commands/`：Claude Code のカスタムコマンド定義

---

## 1.7 Claude Code 初期化

Claude Code 上で当該プロジェクトを開き、以下を実行する。

```claude
/init
```

- 以降のやり取りが、このプロジェクトに紐づいた Project memory として扱われる。

---

## 1.8 ベース MCP の追加  
（Context7 + filesystem + git + exec + text-analysis）

### 1.8.1 目的

プロジェクト開始時に最低限導入しておくべき MCP を設定し、Claude Code が以下を行える状態にする。

- 仕様・ドキュメントの参照（Context7）
- ファイル操作（生成・更新・削除）
- Git 操作（コミット・差分取得）
- ローカルコマンド実行（uv / pytest / Docker など）
- テキスト解析（要件・ログ・ドキュメント）

このフェーズ完了により、Claude を使って  
「要件整理 → 設計 → ADR → 実装 → テスト → 修正」の一連の流れをワークフローとして回せるようにする。

---

### 1.8.2 MCP 追加前提

- 以降のコマンドは **プロジェクトのルートディレクトリ** で実行すること。
- `-s <project>` の `<project>` には、Claude Code 上で認識されているプロジェクト名を指定する。

確認コマンド例：

```sh
claude project current
```

---

### 1.8.3 MCP 追加手順（必須 5 種）

以下の MCP をすべて導入する。

#### 1.8.3.1 Context7 MCP（仕様参照）

```sh
claude mcp add context7 -s <project> -- npx -y @upstash/context7-mcp
```

用途例：
- ライブラリ公式ドキュメント参照
- API 仕様参照
- 最新の各種言語ランタイム / ライブラリの仕様参照

---

#### 1.8.3.2 filesystem MCP（ファイル操作）

```sh
claude mcp add filesystem -s <project>
```

用途例：
- ファイル作成 / 更新 / 削除
- ベースディレクトリの自動生成
- 差分パッチ適用
- 設計書・コードの一括編集

---

#### 1.8.3.3 git MCP（Git 操作）

```sh
claude mcp add git -s <project>
```

用途例：
- コミット作成（メッセージ生成含む）
- 差分レビュー・要約
- Pull Request 用説明文の生成

---

#### 1.8.3.4 exec MCP（ローカルコマンド実行）

```sh
claude mcp add exec -s <project>
```

用途例：
- `uv run` / `uv pip` / `uv lint`
- `ruff` / `mypy` / `pytest`
- `docker` / `docker-compose`
- Jenkins CLI
- Python / Node スクリプト実行

---

#### 1.8.3.5 text-analysis MCP（ログ解析・要件整理）

```sh
claude mcp add text-analysis -s <project>
```

用途例：
- ヒアリングメモの整理
- 要件抽出・構造化
- エラーログ解析
- 設計書・仕様書の要約・要点抽出

---

### 1.8.4 MCP 設定確認（必須）

```sh
claude mcp list
```

以下の 5 つが表示されていれば成功とみなす。

- `context7`  
- `filesystem`  
- `git`  
- `exec`  
- `text-analysis`  

---

### 1.8.5 MCP 導入後の初期チェック

各 MCP が動作することを最低 1 回ずつ確認する。

- filesystem 動作確認

  ```claude
  docs/requirements/test.md を作成し、「MCP OK」とだけ書き込んでください。
  ```

- git 動作確認

  ```claude
  直前の変更を "setup: initial mcp test" というメッセージでコミットしてください。
  ```

- exec 動作確認

  ```claude
  uv run --version を実行し、結果を表示してください。
  ```

- text-analysis 動作確認

  ```claude
  以下の文章を要約してください。use text-analysis

  <<<長文>>>
  ```

- context7 動作確認

  ```claude
  Python の requests ライブラリの最新仕様を context7 で参照し、
  要点だけを箇条書きでまとめてください。use context7
  ```

---

### 1.8.6 MCP フェーズの終了条件

- MCP 5 種が `claude mcp list` に表示されている。
- 各 MCP で最低 1 回の基本操作が成功している。
- `.claude/commands/` に最低限のベースコマンドを配置する準備が整っている。

---

## 1.9 ベースメモリ（Claude.md）作成

プロジェクトの前提・ルール・構造をまとめた `Claude.md` をプロジェクトルートに作成する。

テンプレート例：

```markdown
# Project memory

## Overview
- Project name: <project>
- Purpose: <1〜3行で記述>
- Primary language: Python (uv)
- Main entrypoint: src/main.py

## Tech Stack
- Lint: ruff
- Type check: mypy
- Test: pytest
- MCP:
  - context7
  - filesystem
  - git
  - exec
  - text-analysis

## Repository Layout
- src/
- tests/
- docs/requirements/
- docs/design/
- ADR/
- plans/
- docs/release-notes/

## Process Rules
- Branch strategy: GitHub Flow
- 重要な設計判断は ADR/ に記録する
- 新機能には最低 1 つ以上の自動テストを追加する

## Claude Usage Rules
- 要件/設計に関する生成前に docs/requirements, docs/design を参照させる
- 公式ドキュメントが必要な場合は context7 を使い、プロンプト末尾に `use context7` を付ける
- 大量生成の前に小さなスコープで動作確認を行う
```

作成後、Claude に内容を読み込ませて Project memory として認識させる。

```claude
これがこのプロジェクトの Project memory です。
以降、この内容を前提に振る舞ってください。

<<<Claude.md の内容>>>
```

---

## 1.10 カスタムコマンド追加（`.claude/commands`）

### 1.10.1 目的

- Claude Code のコマンドパレットから、頻出の作業（要件整理・設計生成・プラン作成・実装・品質チェック・リリースノート作成・CI設定）を一貫した形で呼び出せるようにする。
- チーム全体で同じプロンプト・同じフローを共有し、再現性のある開発プロセスを確立する。

---

### 1.10.2 カスタムコマンド作成方法

カスタムコマンドは **`.claude/commands/*.md`** として保存する。

作成依頼例：

```claude
要求整理テンプレートを
.claude/commands/requirements-draft.md に作成してください。
```

Claude 再起動後、`requirements-draft` コマンドとして利用可能になる。

---

### 1.10.3 ベースコマンド一覧

初期セットアップで、少なくとも以下のコマンドを用意する。

#### 必須（要件〜実装〜品質）

1. `requirements-draft.md`  
   - ヒアリングメモ → `docs/requirements/01_stakeholder-needs.md` のドラフト生成。
    ```markdown
    # 要求整理（ヒアリングメモ → STK 要求）

    以下のヒアリングメモを整理し、
    docs/requirements/01_stakeholder-needs.md のドラフトを生成する。

    ## 出力形式
    - ステークホルダーごとにセクション分割
    - 要求ID: STK-001 形式
    - 背景・目的・制約を明記
    - 曖昧なものは質問する

    入力:
    <<<ヒアリングメモ>>>
    ```

2. `requirements-definition.md`  
   - ステークホルダー要求 → `docs/requirements/02_system-requirements.md` の要件定義書生成。
    ```markdown
    # 要件定義生成（要求 → システム要件）

    docs/requirements/01_stakeholder-needs.md を参照し、
    docs/requirements/02_system-requirements.md を生成する。

    ## ルール
    - 機能要件: REQ-F-XXX
    - 非機能要件: REQ-NF-XXX
    - 各要件は関連する STK-ID と紐付ける
    - 曖昧な値は数値化の提案を行う
    ```

3. `create-plan.md`  
   - 機能単位の実装計画 `plans/feature-<機能名>.md` を生成。
   ```markdown
    # 実装計画（プラン）作成

    対象機能 <機能名> のタスク分解を行い、
    plans/feature-<機能名>.md を作成する Markdown を生成する。

    ## 出力構成
    - 背景
    - スコープ（含める/含めない）
    - タスク一覧（1〜2時間粒度）
    - リスク/懸念点
    - 依存関係
    ```

4. `design-from-requirements.md`  
   - 要件定義から `docs/design/<設計対象>.md` を生成（UI/ドメイン/IF設計）。
    ```markdown
    # 設計書生成（UI / ドメイン / IF 設計）

    docs/requirements/02_system-requirements.md を参照し、
    docs/design/<設計対象>.md を生成する。

    必要に応じて:
    - 図（Mermaid）
    - シーケンス図
    - データフロー
    - クラス構成
    を含める。
    ```

5. `adr-create.md`  
   - 新しい設計判断について `ADR/ADR-<番号>-<タイトル>.md` を生成。
    ```markdown
    # ADR（Architecture Decision Record）作成

    新しい設計判断またはアーキテクチャ判断について、
    ADR/ADR-<番号>-<タイトル>.md を生成する。

    ## テンプレ
    - 背景
    - 判断
    - 選択肢
    - メリット/デメリット
    - 根拠
    - トレードオフ
    - 状態（Accepted / Deprecated / Superseded）

    docs/requirements および docs/design を参照し整合性を保つ。
    ```

6. `implement-file.md`  
   - 要件 + プランから `src/<ファイル>.py` と対応する `tests/` を生成または更新。
    ```markdown
    # コード実装（仕様 + プラン → ファイル生成）

    docs/requirements/02_system-requirements.md と
    plans/feature-<機能名>.md を参照し、
    src/<ファイル>.py を生成または更新する。

    ## 制約
    - 型アノテーション必須
    - ruff / mypy / pytest でエラーなし
    - 必要に応じて tests/ に pytest テストも生成
    ```

7. `quality-fix.md`  
   - `ruff` / `mypy` / `pytest` を用いた品質チェックと自動修正。
   ```markdown
    # 品質チェック（ruff / mypy / pytest）

    以下を順に実行できる形式で案内し、必要ならコード修正も行う。

    1. ruff の lint チェック
    2. mypy の型チェック
    3. pytest のテスト実行
    4. エラー内容の解析と修正案の提示
    5. 必要に応じてコードへパッチを適用

    対象:
    - src/ 配下の Python ファイル
    - tests/ 配下のテストコード
    ```

8. `refactor.md`  
    - 既存コードを責務分割・命名改善・重複削除などの方針でリファクタ。
    ```markdown
    # リファクタ（責務分割・命名改善・整理）

    src/<ファイル>.py を読み込み、
    以下を基準にリファクタ案を生成し、必要に応じて修正を適用する。

    - 単一責務
    - 関数分割
    - 命名改善
    - 循環依存の解消
    - 重複コード削除
    - テストの整合性確保
    ```

9. `release-notes.md`  
    - Git のコミット履歴/差分から `docs/release-notes/release-<version>.md` 用のリリースノートを生成。
    ```markdown
    # リリースノート自動生成コマンド

    目的:
    - 直近の変更内容（コミットや差分）をもとに、リリースノートを自動生成する。
    - docs/release-notes/release-<version>.md に貼り付け可能な形式で出力する。

    ## 前提
    - git MCP が有効であること
    - default ブランチ: main
    - 対象範囲: 直近のタグ〜HEAD または 指定範囲

    ## 入力例
    - 対象バージョン: v1.2.0
    - 対象範囲: 直近タグ〜現在HEAD、もしくは `git diff` 範囲

    ## 手順
    1. git のコミット履歴または diff を取得する。
    2. 変更内容をカテゴリ別に分類する。
    - Added
    - Changed
    - Fixed
    - Removed
    - Deprecated
    - Security
    3. docs/release-notes/release-<version>.md 用の Markdown を生成する。

    ## 出力フォーマット例

    ```markdown
    # Release v<version> - <YYYY-MM-DD>

    ## Summary
    - <1〜3行で概要>

    ## Added
    - ...

    ## Changed
    - ...

    ## Fixed
    - ...

    ## Known Issues
    - ...
    ```


10. `ci-cd-setup.md`  
    - プロジェクト構成に基づき、`Jenkinsfile` と `.github/workflows/ci.yml` を生成。

    ```markdown
    # CI/CD 設定コマンド（Jenkinsfile / GitHub Actions）

    目的:
    - プロジェクトの CI/CD 設定ファイル（Jenkinsfile, GitHub Actions Workflow）を
    プロジェクト方針に合わせて自動生成する。

    ## 前提
    - プロジェクトは Python（uv）を利用
    - ruff / mypy / pytest を使った品質チェックを CI で回す
    - main ブランチへの push / PR をトリガーとする

    ## 手順（共通）

    1. プロジェクトルート構成（src, tests, uv, ruff, mypy 設定）を確認する。
    2. Jenkins 用の `Jenkinsfile`（パイプライン）を生成する。
    3. GitHub Actions 用の `.github/workflows/ci.yml` を生成する。
    4. どのツールで何を行うかをコメントとして明記する。

    ## Jenkinsfile の要件

    - パイプライン構成:
    - Checkout
    - Python / uv セットアップ
    - 依存関係インストール
    - ruff 実行
    - mypy 実行
    - pytest 実行
    - main ブランチ向けのパイプライン定義
    - 将来の拡張（デプロイステージ）のためのコメントを残すこと

    ## GitHub Actions ci.yml の要件

    - トリガー:
    - push: main
    - pull_request: main
    - ジョブ:
    - ubuntu-latest で実行
    - Python バージョン 3.x
    - uv インストール
    - 依存関係インストール
    - ruff / mypy / pytest 実行
    - キャッシュ（pip or uv）を可能なら利用

    ## 出力

    - プロジェクトルートに以下のファイルを生成する Markdown or パッチを出力する:
    - `Jenkinsfile`
    - `.github/workflows/ci.yml`
    - 各ステップにコメントを付け、読み手が CI/CD の流れを理解できるようにする。
    ```

