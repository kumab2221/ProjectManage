# 7. 実装計画・プラン作成フェーズ

設計書（`docs/design/*.md`）と ADR を前提に、**実装可能な粒度のタスク一覧とスケジュール**を作成するフェーズ。プランは実装チームが迷わず作業できる「行動計画」として機能する。

---

## 前提条件

- `docs/requirements/02_system-requirements.md`（要件凍結）
- `docs/design/00_system-design.md`（システム設計凍結）
- `docs/design/01_architecture-evaluation.md`（アーキテクチャ評価凍結）
- `ADR/ADR-XXX-*.md`（Status: Accepted）
- `docs/design/*.md`（ソフトウェア設計書凍結）

---

# STEP 1：プラン対象の確定

## 目標
設計書を読み込み、**どの機能を 1 プランとして扱うか**を決定する。原則「1 プラン = 1 機能」。

## 確認すべき事項
1. **対象機能と優先度**  
   - 設計書に記載された機能／ユースケース  
   - MUST / SHOULD / COULD
2. **機能の分割方針**  
   - 大きな機能はサブ機能に分割して複数プランにする
3. **依存関係**  
   - 先行して実装すべき機能、並行可能な機能

## プラン命名規則
- `plans/feature-<機能名>.md`
- 機能名は英小文字＋ハイフン（例：`feature-csv-import.md`、`feature-chart-display.md`）
- 既存プランと重複する場合は `-v2` などバージョンを付ける

---

# STEP 2：プラン Draft 生成（/create-plan）

## 目標
対象機能ごとに `/create-plan` コマンドでプラン Draft を生成する。Draft ではタスクの骨格を整え、後続の Refine で粒度を調整する。

## 使うコマンド
`.claude/commands/create-plan.md`

## Claude への持ち込み例（単一機能）

```claude
/create-plan

docs/design/02_domain-design.md
docs/design/03_infrastructure-design.md
docs/design/04_interface-design.md
ADR ディレクトリ内の全 ADR

対象機能：CSV インポート
優先度：MUST
出力：plans/feature-csv-import.md
```

## Claude への持ち込み例（複数まとめて）

```claude
/create-plan

docs/design/*.md と ADR を参照し、以下の機能のプランを作成してください。

1. CSV インポート ─ plans/feature-csv-import.md
2. チャート表示     ─ plans/feature-chart-display.md
3. 設定管理         ─ plans/feature-settings-management.md

各プランは 1〜2 時間粒度のタスク一覧を含めてください。
```

## Draft の特徴
- 背景 / 目的 / スコープ / タスク / 受入条件 / リスク / スケジュール の枠が埋まる
- タスク粒度は荒い（2〜3 時間程度）でも可
- 依存関係は主要なものだけ記載

---

# STEP 3：プラン Refine（タスク粒度の調整）

## 目標
Draft をレビューし、**すべてのタスクを 1〜1.5 時間で完了できる粒度**まで分割する。依存関係やリスク、受入条件を具体化する。

## レビューチェックリスト
- [ ] **1 プラン = 1 機能** が守られている
- [ ] タスク ID が `TASK-<略称>-<連番>` 形式で採番されている
- [ ] タスク粒度が 1〜1.5 時間以内。長い場合は分割されている
- [ ] 依存関係がタスク ID で明示されている
- [ ] リスクが具体的（Impact / Probability / Mitigation を含む）
- [ ] 受入条件がチェックリスト形式で検証可能

## 修正依頼テンプレート

```claude
plans/feature-csv-import.md をレビューしました。
以下の点を修正してください。

- TASK-CSV-003 を 1.5h 以下になるよう分割
- Out of Scope に「CSV エクスポート」を追加
- Acceptance Criteria をテストケースに直結する形で 4 項目追記
```

---

# STEP 4：プラン Freeze（完了宣言）

## 目標
レビュー済みプランを凍結し、実装フェーズへ正式に引き継ぐ。

## 完了宣言テンプレート

```claude
以下の実装プランを凍結します。

- plans/feature-csv-import.md
- plans/feature-chart-display.md

各プランは 1〜1.5h 粒度のタスク、依存関係、リスク、受入条件を満たしています。
以降、このプランを前提に実装フェーズへ進んでください。
```

---

# 全体フロー

```
STEP 1：プラン対象の確定
  ↓ 設計書から機能と依存を抽出
STEP 2：プラン Draft 生成（/create-plan）
  ↓ plans/feature-*.md を出力
STEP 3：プラン Refine（粒度調整）
  ↓ タスク・依存・リスクを具体化
STEP 4：プラン Freeze（完了宣言）
  ↓ 実装フェーズへハンドオフ
```

---

## 注意事項

- **複数機能を 1 プランに詰め込まない**。大きな機能はサブ機能で分割
- 設計書に存在しないクラス名・操作をプランに追加しない。必要なら設計フェーズへ戻す
- `create-plan` テンプレートの構造（Background / Objective / Scope / Tasks / Risks / Schedule / Acceptance Criteria）を崩さない
- 依存関係には他プランや外部要因（環境構築、ライブラリ入手など）も明記する
- 受入条件は曖昧な表現（「ちゃんと動く」等）を禁止し、測定可能な条件にする

---

## 成果物

- `plans/feature-csv-import.md`
- `plans/feature-chart-display.md`
- `plans/feature-settings-management.md`
- …必要な機能数だけ継続

これらのプランが、実装フェーズ（コーディング・テスト実行）の進捗管理指針となる。
